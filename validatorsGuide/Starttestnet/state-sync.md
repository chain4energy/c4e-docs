<!--
παραγγελία: 8
-->
# Συγχρονισμός με state-sync

Το State-sync είναι μια λειτουργική μονάδα ενσωματωμένη στο Cosmos SDK για να επιτρέπει στους επικυρωτές να ενταχθούν γρήγορα στο δίκτυο συγχρονίζοντας τον κόμβο σας με ένα RPC με δυνατότητα στιγμιότυπου από ένα αξιόπιστο ύψος μπλοκ.&#x20;

Αυτό μειώνει σημαντικά τον χρόνο που απαιτείται για να συγχρονιστεί ένας επικυρωτής ή ο φύλακας με το δίκτυο από ημέρες σε λεπτά. Οι περιορισμοί αυτού είναι ότι δεν υπάρχει πλήρες ιστορικό συναλλαγών, απλώς η πιο πρόσφατη κατάσταση που έχει αποθηκεύσει το RPC συγχρονισμού κατάστασης. Ένα πλεονέκτημα του συγχρονισμού κατάστασης είναι ότι η βάση δεδομένων είναι πολύ μικρή σε σύγκριση με έναν πλήρως συγχρονισμένο κόμβο, επομένως η χρήση του συγχρονισμού κατάστασης για τον επανασυγχρονισμό του κόμβου σας στο δίκτυο μπορεί να σας βοηθήσει να διατηρήσετε το κόστος λειτουργίας χαμηλότερο ελαχιστοποιώντας τη χρήση αποθήκευσης.

Συγχρονίζοντας στο δίκτυο με συγχρονισμό κατάστασης, ένας κόμβος μπορεί να αποφύγει όλες τις διαδικασίες αναβάθμισης και μπορεί να συγχρονιστεί μόνο με το πιο πρόσφατο δυαδικό αρχείο.

Για κόμβους που προορίζονται να εξυπηρετούν δεδομένα για dapps, εξερευνητές ή οποιοδήποτε άλλο RPC που απαιτεί πλήρες ιστορικό, ο συγχρονισμός κατάστασης στο δίκτυο δεν θα ήταν κατάλληλος.&#x20;

## Συγχρονισμός κατάστασης κύριου δικτύου
Το Snapshot λειτουργούν σε rpc1 και rpc2


<mark>
ΠΡΟΕΙΔΟΠΟΙΗΣΗ: Αυτή η τεκμηρίωση προϋποθέτει ότι έχετε ακολουθήσει όλες τις προηγούμενες οδηγίες

Η ρύθμιση παραμέτρων συγχρονισμού κατάστασης είναι η εξής:

``` bash
Το # snapshot-interval καθορίζει το διάστημα μπλοκ στο οποίο βρίσκονται τα στιγμιότυπα συγχρονισμού τοπικής κατάστασης
Λήφθηκε # (0 για απενεργοποίηση). Πρέπει να είναι πολλαπλάσιο του κλάδεμα-κρατήστε-κάθε.
στιγμιότυπο-διάστημα = 1000

Το # snapshot-keep-recent καθορίζει τον αριθμό των πρόσφατων στιγμιότυπων προς διατήρηση και προβολή (0 για να διατηρηθούν όλα).
snapshot-keep-recent = 10
```

Ορίστε τις μεταβλητές "SNAP_RPC1" και "SNAP_RPC2".

``` bash
SNAP_RPC1="https://rpc-testnet.c4e.io:443"
SNAP_RPC2="https://rpc-testnet.c4e.io:443"
```

Λάβετε το "LATEST_HEIGHT" από το στιγμιότυπο RPC, ορίστε τον συγχρονισμό κατάστασης "BLOCK_HEIGHT" και λάβετε το "TRUST_HASH" από το στιγμιότυπο RPC. Το "BLOCK_HEIGHT" προς συγχρονισμό προσδιορίζεται αφαιρώντας το διάστημα του στιγμιότυπου από το "LATEST_HEIGHT".&#x20;

``` bash
LATEST_HEIGHT=$(curl -s https://rpc-testnet.c4e.io:443/block | jq -r .result.block.header.height); \
BLOCK_HEIGHT=$((LATEST_HEIGHT - 1000)); \
TRUST_HASH=$(curl -s "https://rpc-testnet.c4e.io:443/block?height=$BLOCK_HEIGHT" | jq -r .result.block_id.hash)
```

Ελέγξτε τις μεταβλητές για να βεβαιωθείτε ότι έχουν οριστεί

``` bash
ηχώ $LATEST_HEIGHT $BLOCK_HEIGHT $TRUST_HASH

Η έξοδος # θα πρέπει να είναι κάτι παρόμοιο με:
# 29604 28604 2BB3A74046C625CB67D477550D99F2439D48191FD0E840FA42A324B0629A612A
```

Σταματήστε την υπηρεσία cosmovisor
``` bash
sudo systemctl stop cosmovisor
```

Ορίστε τις απαιτούμενες μεταβλητές στο `~/.c4ed/config/config.toml`

``` bash
sed -i.bak -E "s|^(enable[[:space:]]+=[[:space:]]+).*$|\1true| ; \
s|^(rpc_servers[[:space:]]+=[[:space:]]+).*$|\1\"$SNAP_RPC1,$SNAP_RPC2\"| ; \
s|^(trust_height[[:space:]]+=[[:space:]]+).*$|\1$BLOCK_HEIGHT| ; \
s|^(trust_hash[[:space:]]+=[[:space:]]+).*$|\1\"$TRUST_HASH\"|" $HOME/.c4e-chain/config/config.toml
```

Επαναφέρετε τη βάση δεδομένων του κόμβου


<μαρκάρετε >
ΠΡΟΕΙΔΟΠΟΙΗΣΗ: Αυτό θα διαγράψει τη βάση δεδομένων του κόμβου σας. Εάν εκτελείτε ήδη το πρόγραμμα επικύρωσης, βεβαιωθείτε ότι έχετε δημιουργήσει αντίγραφα ασφαλείας των "config/priv_validator_key.json" και "config/node_key.json" πριν από την εκτέλεση του "unsafe-reset-all".
</mark>

Συνιστάται να αντιγράψετε το «data/priv_validator_state.json» σε ένα αντίγραφο ασφαλείας και να το επαναφέρετε μετά το «unsafe-reset-all» για να αποφύγετε πιθανή διπλή υπογραφή.


``` bash
c4ed tendermint unsafe-reset-all --home $HOME/.c4e-chain
```

Επανεκκινήστε τον κόμβο και ελέγξτε τα αρχεία καταγραφής

``` bash
sudo systemctl restart cosmovisor && journalctl -u cosmovisor -f
```
